---
- name: "Download {{ plugin_item.key }}"
  unarchive:
    src: "{{ plugin_item.value.src }}"
    dest: "{{ deploy_helper.new_release_path }}"
    remote_src: true
    validate_certs: "{{ plugin_item.value.validate_certs | default(true) }}"
    owner: "{{ minecraft_user }}"
    group: "{{ minecraft_group }}"
  changed_when: False
  when: plugin_item.value.type is defined and plugin_item.value.type == "archive"

- name: direct set the jar download url
  set_fact:
      plugin_download_src: "{{ plugin_item.value.src }}"
  when: (".jar" in plugin_item.value.src)

- include_tasks: plugin_download_jenkins.yml
  when: plugin_item.value.type is defined and plugin_item.value.type == "jenkins_latest"

- name: "Download {{ plugin_item.key }}"
  get_url:
    url: "{{ plugin_download_src }}"
    dest: "{{ deploy_helper.new_release_path }}"
    validate_certs: "{{ plugin_item.value.validate_certs | default(true) }}"
    owner: "{{ minecraft_user }}"
    group: "{{ minecraft_group }}"
  changed_when: False
  when:
    (plugin_item.value.type is undefined or plugin_item.value.type != "archive") and
    (".jar" in plugin_item.value.src)

- include_tasks: plugin_configure.yml
  with_items: "{{ plugin_item.value.config }}"
  loop_control:
    loop_var: plugin_config_item
  when: plugin_item.value.config is defined
